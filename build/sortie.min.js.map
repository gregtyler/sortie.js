{"version":3,"sources":["sortie.js"],"names":["root","factory","define","amd","module","exports","Sortie","this","polyfillCustomEvent","event","params","bubbles","cancelable","detail","undefined","evt","document","createEvent","initCustomEvent","strReverse","str","split","reverse","join","parseDate","format","parts","replace","match","type","start","substr","length","Date","yyyy","mm","dd","hh","ii","ss","textContent","node","SortieInstance","$table","options","getOptions","dataAttr","attributes","dataOptions","i","l","attr","name","normkey","toLowerCase","value","Object","assign","defaults","init","sorts","sort","getAttribute","$headers","console","error","setAttribute","col","$button","createElement","style","backgroundColor","border","innerHTML","markers","unsorted","$header","whiteSpace","cursor","addEventListener","sortFactory","_data","set","compareFactory","appendChild","createTextNode","dir","initialsort","opts","toString","parseInt","$th","$btn","get","rows","Array","prototype","slice","call","$body","querySelectorAll","current","desc","asc","$el","removeAttribute","frag","createDocumentFragment","dispatchEvent","events","afterSorted","sortSpec","bits","operation","args","callback","compareFunctions","a","b","cellA","children","cellB","order","window","querySelector","create","el","registerComparison","codes","target","TypeError","output","index","arguments","source","nextKey","hasOwnProperty","defineProperty","getOwnPropertyDescriptor","Element","innerText","s","CustomEvent","Event","sortAsc","sortDesc","getIndex","$obj","data","__obj","push","key","val","ah","trim","bh","localeCompare","dateFormat","dateA","dateB","aInt","bInt","isNaN"],"mappings":"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","file":"sortie.min.js","sourcesContent":["/*!\n * Sortie.js v<<VERSION>>\n * An inoffensive table sorter for developers\n */\n(function(root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define([], factory);\n    } else if (typeof module === 'object' && module.exports) {\n        // Node. Does not work with strict CommonJS, but only CommonJS-like\n        // environments that support module.exports, like Node.\n        module.exports = factory();\n    } else {\n        // Browser globals (root is window)\n        root.Sortie = factory();\n    }\n}(this, function SortieConstructor() { // jscs:ignore requirePaddingNewLinesAfterBlocks\n    'use strict';\n\n    /**\n     * Variable definitions\n     */\n    var defaults = {\n        initialsort: -1,\n        markers: {\n            asc: '&#8595;',\n            desc: '&#8593;',\n            unsorted: '&#8597;'\n        }\n    };\n\n    var compareFunctions = {};\n\n    // A polyfill for Object.assign\n    if (typeof Object.assign != 'function') {\n      Object.assign = function(target) {\n        if (target === undefined || target === null) {\n          throw new TypeError('Cannot convert undefined or null to object');\n        }\n\n        var output = Object(target);\n        for (var index = 1; index < arguments.length; index++) {\n          var source = arguments[index];\n          if (source !== undefined && source !== null) {\n            for (var nextKey in source) {\n              if (source.hasOwnProperty(nextKey)) {\n                output[nextKey] = source[nextKey];\n              }\n            }\n          }\n        }\n        return output;\n      };\n    }\n\n    // A polyfill for textContent\n    if (Object.defineProperty\n      && Object.getOwnPropertyDescriptor\n      && Object.getOwnPropertyDescriptor(Element.prototype, 'textContent')\n      && !Object.getOwnPropertyDescriptor(Element.prototype, 'textContent').get) {\n      var innerText = Object.getOwnPropertyDescriptor(Element.prototype, 'innerText');\n      Object.defineProperty(Element.prototype, 'textContent', {\n          get: function() {\n            return innerText.get.call(this);\n          },\n          set: function(s) {\n            return innerText.set.call(this, s);\n          }\n        }\n      );\n    }\n\n    // A polyfill for CustomEvent\n    function polyfillCustomEvent(event, params) {\n      params = params || { bubbles: false, cancelable: false, detail: undefined };\n      var evt = document.createEvent('CustomEvent');\n      evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n      return evt;\n    }\n\n    if (typeof window.CustomEvent === 'function') {\n      polyfillCustomEvent.prototype = window.Event.prototype;\n\n      window.CustomEvent = polyfillCustomEvent;\n    }\n\n    // Events that can be called/listened to\n    var events = {\n      // These can be fired to sort the table\n      sortAsc: new CustomEvent('sortie:sortAsc'),\n      sortDesc: new CustomEvent('sortie:sortDesc'),\n      // This is fired after the table is sorted\n      afterSorted: new CustomEvent('sortie:afterSorted')\n    };\n\n    // A little internal data tracker\n    var _data = (function() {\n        var data = [];\n\n        function getIndex($obj) {\n            for (var index = 0, l = data.length; index < l; index++) {\n                if (data[index].__obj === $obj) {\n                    return index;\n                }\n            }\n\n            // Otherwise, create the item\n            data.push({__obj: $obj});\n            return data.length - 1;\n        }\n\n        function get($obj, key) {\n            var index = getIndex($obj);\n\n            if (data[index] && data[index][key]) {\n                return data[index][key];\n            } else {\n                return null;\n            }\n        }\n\n        function set($obj, key, val) {\n            var index = getIndex($obj);\n\n            if (typeof data[index] === 'undefined') {\n                data[index] = {};\n            }\n\n            data[index][key] = val;\n        }\n\n        return {\n            get: get,\n            set: set\n        }\n    }());\n\n    /**\n     * Reverse a string\n     */\n    function strReverse(str) {\n        return str.split('').reverse().join('');\n    }\n\n    /**\n     * Parse a date from a format\n     * e.g. parseDate('1990-07-26 07:24', 'yyyy-mm-ss hh:ii')\n     */\n    function parseDate(str, format) {\n        var parts = {};\n        if (typeof format === 'undefined') format = 'yyyy-mm-dd';\n        format.replace(/(dd|mm|yyyy|hh|ii)/g, function(match, type, start) {\n            parts[type] = str.substr(start, type.length);\n        });\n\n        return new Date(\n            parts.yyyy || 0,\n            (parts.mm - 1) || 0,\n            parts.dd || 1,\n            parts.hh || 0,\n            parts.ii || 0,\n            parts.ss || 0\n        );\n    }\n\n    /**\n     * Get the text content of a node\n     */\n    function textContent(node) {\n        return node.textContent;\n    }\n\n    function SortieInstance($table, options) {\n        // Get the variables we'll be using in this sortie object\n        var $body = $table.querySelector('tbody');\n        var $headers = $table.querySelectorAll('thead th');\n        var current;\n\n        /**\n        * Get the options object\n        */\n        function getOptions() {\n            var dataAttr = $table.attributes;\n            var dataOptions = {};\n            for (var i = 0, l = dataAttr.length; i < l; i++) {\n                var attr = dataAttr[i];\n\n                if (attr.name.substr(0, 11) === 'data-sortie' && attr.name.length > 11) {\n                    var normkey = attr.name.toLowerCase().replace(/-/g, '');\n                    dataOptions[normkey.substr(11)] = attr.value;\n                }\n            }\n\n            return Object.assign(true, {}, defaults, options, dataOptions);\n        }\n\n        /**\n         * Initialise sortie\n         */\n        function init() {\n            // Set the options object\n            options = getOptions();\n\n            // Determine the sort order\n            var sorts;\n            if (typeof options.sort !== 'undefined') {\n                sorts = options.sort;\n            } else {\n                sorts = $table.getAttribute('data-sortie');\n            }\n\n            // If there's no suitable sorting string, drop out\n            if (sorts === null) return false;\n\n            // If the sorts were a string, turn them into an object\n            if (typeof sorts === 'string') {\n                sorts = sorts.split('|');\n            }\n\n            if (sorts.length > $headers.length) {\n                console.error('Sortie config error: Too many sort columns specified');\n            }\n\n            // Add aria role-live settings and\n            $table.setAttribute('aria-atomic', true);\n            $table.setAttribute('aria-live', 'polite');\n            $table.setAttribute('aria-relevant', 'all');\n\n            // Generate an ID for the table\n            if (!$table.getAttribute('id')) {\n                $table.setAttribute('id', 'sortieTable' + (new Date() * 1));\n            }\n\n            // Add sortie specification to each column\n            for (var col in sorts) {\n                // Skip columns with no sort criteria\n                if (!sorts[col]) continue;\n\n                // Add a sorting icon to click\n                var $button = document.createElement('button');\n                $button.style.backgroundColor = 'transparent';\n                $button.style.border = 'none';\n                $button.innerHTML = options.markers.unsorted;\n                $button.setAttribute('type', 'button');\n                $button.setAttribute('aria-controls', $table.getAttribute('id'));\n\n                var $header = $headers[col];\n                $header.style.whiteSpace = 'nowrap';\n                $header.style.cursor = 'pointer';\n                $header.addEventListener('click', sortFactory(col));\n                $header.setAttribute('data-sortie', true);\n                _data.set($header, 'sortieCompareFunction', compareFactory(col, sorts[col]));\n                _data.set($header, 'sortieButton', $button);\n                $header.appendChild(document.createTextNode(' '));\n                $header.appendChild($button);\n\n                // When the table is asked to be filtered, filter it\n                $header.addEventListener('sortie:sortAsc', sortFactory(col, {dir: 'ASC'}));\n                $header.addEventListener('sortie:sortDesc', sortFactory(col, {dir: 'DESC'}));\n            }\n\n            // Perform an initial sort\n            if (options.initialsort !== false) {\n                var opts = {};\n                if (options.initialsort.toString().substr(-1, 1) === 'D') {\n                    opts.dir = 'DESC';\n                } else if (options.initialsort.toString().substr(-1, 1) === 'A') {\n                    opts.dir = 'ASC';\n                } else if (options.initialsort.toString() === '-1') {\n                    for (var i = 0, l = sorts.length; i < l; i++) {\n                        if (sorts[i]) {\n                            options.initialsort = i;\n                            break;\n                        }\n                    }\n                }\n\n                sort(options.initialsort, opts);\n            }\n        }\n\n        // Factory for the sort function\n        function sortFactory(col, opts) {\n            return function() {\n                sort(col, opts);\n            }\n        }\n\n        /**\n         * Sort the table by the given column\n         */\n        function sort(col, opts) {\n            // Convert col to an integer\n            col = parseInt(col, 10);\n\n            var opts = Object.assign({}, opts);\n            var $th = $headers[col];\n            //var $btn = $th.getAttribute('data-sortieButton');\n            var $btn = _data.get($th, 'sortieButton');\n            var rows = Array.prototype.slice.call($body.querySelectorAll('tr'), 0);\n            var dir = typeof opts.dir !== 'undefined' ? opts.dir : 'ASC';\n\n            // Get the sort order\n            if (current === col && _data.get($th, 'sortieDirection') === 'ASC' && typeof opts.dir == 'undefined') {\n                dir = 'DESC';\n            }\n\n            // Save the new state\n            current = col;\n            _data.set($th, 'sortieDirection', dir);\n            $th.setAttribute('aria-sort', dir.toLowerCase() + 'ending')\n\n            // Perform the sort\n            rows.sort(_data.get($th, 'sortieCompareFunction'));\n\n            // Update the button's HTML\n            if (dir === 'DESC') {\n                $btn.innerHTML = options.markers.desc;\n                rows = rows.reverse();\n            } else {\n                $btn.innerHTML = options.markers.asc;\n            }\n\n            // Update the other buttons\n            for (var i = 0, l = $headers.length; i < l; i++) {\n                var $el = $headers[i];\n                // Only update \"other\" buttons\n                if ($el === $th) continue;\n\n                // Reset each button\n                $el.removeAttribute('aria-sort');\n                if ($el.getAttribute('data-sortie')) {\n                    _data.get($el, 'sortieButton').innerHTML = options.markers.unsorted;\n                }\n            }\n\n            // Update the content of the now-sorted table\n            var frag = document.createDocumentFragment();\n\n            for (var i in rows) {\n                frag.appendChild(rows[i]);\n            }\n\n            // Fire an event to notify that the table was sorted\n            $table.dispatchEvent(events.afterSorted);\n\n            // Put the now sorted rows back onto the page\n            $body.innerHTML = '';\n            $body.appendChild(frag);\n        }\n\n        /**\n         * Return the suitable comparison function for the column\n         */\n        function compareFactory(col, sortSpec) {\n            var bits = sortSpec.split(':');\n            var operation = bits[0];\n            var args = bits[1] ? bits[1].split(',') : [];\n            var callback = compareFunctions[operation];\n\n            if (typeof callback !== 'function') {\n                console.error('Sortie error: comparison function not found for rule \"' + operation + '\"');\n                var callback = function() {return 0};\n            }\n\n            return function compare(a, b) {\n                var cellA = a.children[col];\n                var cellB = b.children[col];\n\n                var order = callback.call(window, cellA, cellB, args);\n\n                // If asked to, reverse the search order\n                return sortSpec.substr(1, 1) === 'r' ? -order : order;\n            }\n        }\n\n        // Run the initialisation\n        init();\n\n        // Return values\n        return { sort: sort };\n    }\n\n    // Create a new sortie instance\n    function create(el, options) {\n        return new SortieInstance(el, options);\n    }\n\n    // Register a new comparison function\n    function registerComparison(codes, callback) {\n        if (typeof codes === 'string') codes = [codes];\n\n        // Register against each code provided\n        for (var i = 0, l = codes.length; i < l; i++) {\n            compareFunctions[codes[i]] = callback;\n        }\n    }\n\n    /*** Comparison functions ***/\n\n    // Compare alphanumerically\n    registerComparison(['a', 'alpha'], function compareAlpha(cellA, cellB) {\n        var ah = textContent(cellA).trim();\n        var bh = textContent(cellB).trim();\n        if (cellA.dir === 'rtl') ah = strReverse(ah);\n        if (cellB.dir === 'rtl') bh = strReverse(bh);\n        return ah.localeCompare(bh);\n    });\n\n    // Compare by date attributes\n    registerComparison(['d', 'date'], function compareDate(cellA, cellB, args) {\n        var dateFormat = args[0];\n        var dateA = parseDate(textContent(cellA), dateFormat);\n        var dateB = parseDate(textContent(cellB), dateFormat);\n\n        if (dateA > dateB) {\n            return 1;\n        } else if (dateA < dateB) {\n            return -1;\n        } else {\n            return 0;\n        }\n    });\n\n    // Compare integers\n    registerComparison(['i', 'int'], function compareInt(cellA, cellB) {\n        var aInt = parseInt(textContent(cellA), 10);\n        var bInt = parseInt(textContent(cellB), 10);\n        if (isNaN(bInt)) {\n            return isNaN(aInt) ? 0 : 1;\n        } else if (isNaN(aInt)) {\n            return -1;\n        } else {\n            return aInt - bInt;\n        }\n    });\n\n    /**\n     * Return public methods\n     */\n    return {\n        create: create,\n        events: events,\n        registerComparison: registerComparison\n    };\n}));\n"],"sourceRoot":"/source/"}